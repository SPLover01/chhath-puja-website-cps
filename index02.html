<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Prasad Order - Chhath Puja 2025</title>
  <link rel="stylesheet" href="newstyle.css">
  <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;700&family=Montserrat:wght@300;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
  <style>
    #qrBox {
      display: none;
      text-align: center;
      justify-content: center;
      align-items: center; 
      margin: 20px;
    }
    #qrBox canvas {
      margin-top: 15px;
    }
  </style>
</head>
<body>
  <section class="rituals" id="orders">
    <h2 data-aos="fade-up">Prasad Options</h2>
    <div class="ritual-cards">
      <div class="card" data-aos="flip-left">
        <img src="prasad/chawalThekua.jpeg" alt="Traditional Prasad">
        <h3>Traditional Prasad</h3><br>
        <p>500g - ‚Çπ1</p>
        <div class="quantity">
          <button onclick="updateQuantity('qty1', -1)">-</button>
          <input type="number" id="qty1" value="0" min="0" readonly>
          <button onclick="updateQuantity('qty1', 1)">+</button>
        </div>
      </div>
      <div class="card" data-aos="flip-left" data-aos-delay="100">
        <img src="prasad/coconetthekua.jpg" alt="Sugarfree Thekua">
        <h3>Sugarfree Thekua</h3><br>
        <p>500g - ‚Çπ1</p>
        <div class="quantity">
          <button onclick="updateQuantity('qty2', -1)">-</button>
          <input type="number" id="qty2" value="0" min="0" readonly>
          <button onclick="updateQuantity('qty2', 1)">+</button>
        </div>
      </div>
      <div class="card" data-aos="flip-left" data-aos-delay="200">
        <img src="prasad/thekua5.jpg" alt="Rice Thekua">
        <h3>Rice Thekua</h3><br>
        <p>500g - ‚Çπ1</p>
        <div class="quantity">
          <button onclick="updateQuantity('qty3', -1)">-</button>
          <input type="number" id="qty3" value="0" min="0" readonly>
          <button onclick="updateQuantity('qty3', 1)">+</button>
        </div>
      </div>
      <div class="card" data-aos="flip-left" data-aos-delay="300">
        <img src="prasad/thekua2.jpg" alt="Special Prasad">
        <h3>Special Prasad</h3><br>
        <p>500g - ‚Çπ1</p>
        <div class="quantity">
          <button onclick="updateQuantity('qty4', -1)">-</button>
          <input type="number" id="qty4" value="0" min="0" readonly>
          <button onclick="updateQuantity('qty4', 1)">+</button>
        </div>
      </div>
    </div>
    <br>
    <button class="btn btn-secondary" onclick="showQRCode()">Pay & Place Order</button>
  </section>

  <div id="qrOverlay">
    <div id="qrBox">
      <span class="closeBtn" onclick="closeQRBox()">&times;</span>
      <h3>Scan to Pay via UPI</h3>
      <canvas id="qrcode"></canvas>
      <p id="amountText"></p>
      <button onclick="confirmPayment()">‚úÖ I Have Paid</button>
    </div>
  </div>

  <footer class="footer">
    <p>Share the Spirit of Chhath Puja</p>
    <div class="social-buttons">
      <a href="#" class="btn btn-social"><i class="fab fa-facebook-f"></i></a>
      <a href="#" class="btn btn-social"><i class="fab fa-whatsapp"></i></a>
      <a href="#" class="btn btn-social"><i class="fab fa-instagram"></i></a>
    </div>
    <p>&copy; 2025 Chhath Puja. All Rights Reserved.</p>
  </footer>

  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
  <script>
  AOS.init({ duration: 1000, once: true });

  function updateQuantity(inputId, change) {
    const input = document.getElementById(inputId);
    let value = parseInt(input.value);
    value = Math.max(0, value + change);
    input.value = value;
  }

  const products = [
    { name: "Traditional Prasad", id: "qty1", price: 1 },
    { name: "Sugarfree Thekua", id: "qty2", price: 1 },
    { name: "Rice Thekua", id: "qty3", price: 1 },
    { name: "Special Prasad", id: "qty4", price: 1 }
  ];

  let finalOrder = [];
  let finalAmount = 0;

  function isMobileDevice() {
    return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || window.innerWidth <= 768;
  }

  function showQRCode() {
    finalOrder = [];
    finalAmount = 0;

    products.forEach(p => {
      const qty = parseInt(document.getElementById(p.id).value);
      if (qty > 0) {
        finalOrder.push({ ...p, qty });
        finalAmount += qty * p.price;
      }
    });

    if (finalOrder.length === 0) {
      alert("‡§ï‡•É‡§™‡§Ø‡§æ ‡§ï‡§Æ ‡§∏‡•á ‡§ï‡§Æ 1 item ‡§ö‡•Å‡§®‡•á‡§Ç‡•§");
      return;
    }

    const upiId = "7053624683@ybl";
    const upiUrl = `upi://pay?pa=${upiId}&pn=TiwariSweet's&am=${finalAmount}&cu=INR&tn=Prasad Order`;

    if (isMobileDevice()) {
      window.location.href = upiUrl;
      setTimeout(() => {
        confirmPayment();
      }, 5000); // Delay to allow payment app to open
    } else {
      document.getElementById("qrBox").style.display = "block";
      document.getElementById("amountText").innerText = `Pay ‚Çπ${finalAmount} only`;

      QRCode.toCanvas(document.getElementById("qrcode"), upiUrl, function (error) {
        if (error) console.error(error);
      });
    }
  }

  function closeQRBox() {
    document.getElementById("qrBox").style.display = "none";
  }

  function confirmPayment() {
    const fakePaymentId = "UPI-" + Date.now();
    alert("‚úÖ Payment confirmed!");
    sendToWhatsApp(finalOrder, finalAmount);
    generateBillPDF(finalOrder, finalAmount, fakePaymentId);
  }

  function sendToWhatsApp(orderItems, totalAmount) {
    let message = "‚úÖ Payment Done!\nYour Order Details:\n\n";
    orderItems.forEach(p => {
      message += `${p.name} - ${p.qty} x 500g = ‚Çπ${p.qty * p.price}\n`;
    });
    message += `\nTotal: ‚Çπ${totalAmount}`;
    const whatsappNumber = "+917053624683";
    const whatsappUrl = `https://wa.me/${whatsappNumber}?text=${encodeURIComponent(message)}`;
    window.open(whatsappUrl, "_blank");
  }

  function generateBillPDF(orderItems, totalAmount, paymentId) {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    const currentDate = new Date().toLocaleDateString('en-IN');
    const currentTime = new Date().toLocaleTimeString('en-IN');

    doc.setFontSize(16);
    doc.text("Tiwari Sweet's House. - Cash Memo", 60, 20);
    doc.text("Phone No. 7053624683", 70, 30);

    doc.setFontSize(12);
    doc.text(`Date: ${currentDate} ${currentTime}`, 20, 40);
    doc.text(`Payment ID: ${paymentId}`, 20, 50);

    let y = 70;
    orderItems.forEach(p => {
      doc.text(`${p.name} - ${p.qty} x 500g = ‚Çπ${p.qty * p.price}`, 20, y);
      y += 10;
    });

    doc.text(`---------------------------`, 20, y);
    y += 10;
    doc.text(`Total Amount: ‚Çπ${totalAmount}`, 20, y);
    y += 20;
    doc.text("üôè Thank you for your order!", 20, y);

    doc.save(`CashMemo_${currentDate}.pdf`);
  }
  </script>
</body>
</html>
